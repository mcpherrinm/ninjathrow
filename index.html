<!doctype html>
<html>
<head>
 <title>Ninja Throw!</title>
<meta name="viewport" content="initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>

<style>
  body.connected #login { display: none; }
  body.connected #logout { display: block; }
  body.not_connected #login { display: block; }
      body.not_connected #logout { display: none; }
</style>


</head>
<body>
 <div id="login">
   <p><button onClick="loginUser();">Login</button></p>
 </div>
 <div id="logout">
   <p><button  onClick="FB.logout();">Logout</button></p>
 </div>

 <script>
   function loginUser() {    
     FB.login(function(response) { }, {scope:'email'});     
     }
 </script>


<div id="fb-root"></div>
<div id="user-info"></div>
<a href="#" onclick="publishStory();">Publish feed story</a><br>

<script>
"use strict";
function handleStatusChange(response) {
  document.body.className = response.authResponse ? 'connected' : 'not_connected';
  if (response.authResponse) {
    console.log(response);
    updateUserInfo(response);
  }
}
function updateUserInfo(response) {
  FB.api('/me', function(response) {
    document.getElementById('user-info').innerHTML = '<img src="https://graph.facebook.com/' + response.id + '/picture">' + response.name;
  });
}

window.fbAsyncInit = function() {
  FB.init({
    appId      : '571809482834267', // App ID
    channelUrl : '//mcpherrin.ca/ninjathrow/channel.html', // Channel File
    status     : true, // check login status
    cookie     : true, // enable cookies to allow the server to access the session
    xfbml      : true  // parse XFBML
  });

  FB.Event.subscribe('auth.statusChange', handleStatusChange);
};

// Load the SDK Asynchronously
(function(d){
   var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
   if (d.getElementById(id)) {return;}
   js = d.createElement('script'); js.id = id; js.async = true;
   js.src = "//connect.facebook.net/en_US/all.js";
   ref.parentNode.insertBefore(js, ref);
 }(document));

function publishStory() {
  FB.ui({
    method: 'feed',
    name: 'I\'m building a social local mobile web app!',
    caption: 'imdabes',
    description: 'hackathoooooon',
    link: 'http://mcpherrin.ca/ninjathrow/',
    picture: 'http://mcpherrin.ca/ninjathrow/ninjastar.png'
  }, 
  function(response) {
    console.log('publishStory response: ', response);
  });
  return false;
}
</script>
</body>
</html>
